<html>
<head>
<script>

  // Define the creative's size here:
  var tagWidth = ${WIDTH};
  var tagHeight = ${HEIGHT};

  //Define vars dynamically for Rubicon and Openx
  var siteId = 0;
  var zoneId = 0;
  var sizes = 0;
  var unit = 0;

  switch (${SITE_ID}) {
    case 2404742:
        var siteId = '88956';
        var zoneId = '419150';
        break;
  }

  switch (${HEIGHT}) {
    //TOP
    case 90:
      var sizes = [2];
      var unit = '538660479';
      break;
    //Middle1
    case 600:
      var sizes = [10];
      var unit = '538660477';
      break;
    case 300:
    case 250:
    //Middle2
    case 301:
    case 251:
      var sizes = [15];
      var unit = '538660478';
      break;
  }

  // Add your bids of the defined size for this ad unit here:
  var bids = [{
      bidder: 'rubicon',

		params: {
		  accountId: '15052',
			siteId: siteId,
			zoneId: zoneId,
			position: 'atf',
      sizes: sizes
		}
	},{
		bidder: 'openx',
		params: {
			//jstag_url: 'https://uk-ads.openx.net/w/1.0/jstag',
      delDomain: '//scmspain-d.openx.net',
			unit: unit //units of each placement
		}
	}
    // Add more header bidding bids here.
  ];

  // Define how long your creative should wait for the bids in ms.
  var bidTimeOut = 1000;

  // Define the passback HTML tag here. Note that this tag
  // is usually in either script tag form or iframe form.
  var ADXTagHtml = ' google_alternate_ad_url = "https://s.dcdn.es/prebid/postbid.html"; google_ad_client = "ca-pub-9437107759851097"; google_ad_width = '+${WIDTH}+'; google_ad_height = '+${HEIGHT}+'; google_enable_async = false;</sc' + 'ript><scr' + 'ipt type="text/javascript" src="//pagead2.googlesyndication.com/pagead/show_ads.js">';

  // ======= DO NOT EDIT BELOW THIS LINE =========== //
</script>

<script type="text/javascript" src="https://s.dcdn.es/prebid/prebid_new.js" async></script>

<script>

  var ADXFloors = {	"5": "2664586470",
					"10": "4141294350",
					"15": "5618002230",
					"20": "7094710110",
					"25": "8571417990",
					"30": "1048125870",
					"35": "2524833750",
					"40": "4001541630",
					"45": "5478249510",
					"50": "6954957390"
				};

	function displayWinnerHB (iframeDoc){
			var params = pbjs.getAdserverTargetingForAdUnitCode(doNotChange);
			 if (params && params['hb_adid']){
					pbjs.que.push(function() {
						pbjs.renderAd(iframeDoc, params['hb_adid']);
					});
			} else {
document.write("<scr" + "ipt type='text/javascript' src='" + (("https:" == document.location.protocol) ? "https://secure." : "http://ib.") + "adnxs.com/ttj?id=${TAG_ID}&size=${WIDTH}x${HEIGHT}&cb=${CACHEBUSTER}&psa=0&pt9=postbidpassback'></scr" + "ipt>");
			}
	}

  var pbjs = pbjs || {};
  pbjs.que = pbjs.que || [];

  pbjs.bidderSettings = {
    standard: {
      alwaysUseBid: false,
      adserverTargeting: [{
        key: "hb_pb",
        val: function(bidResponse) {
          return Math.min(50, parseInt(bidResponse.cpm * 10 / 5) * 5 + 5);
        }
      },
      /*{
        key: 'hb_bidder',
        val: function (bidResponse) {
          return bidResponse.bidderCode;
        }
      },*/
      {
        key: 'hb_adid',
        val: function (bidResponse) {
          return bidResponse.adId;
        }
      },
      {
        key: 'hb_size',
        val: function (bidResponse) {
          return bidResponse.size;
        }
      }
      ]
    }
  };


  // bidsbackhandler as extra function for easier reinvocation
  pbjs.customBidsBackHandler = function () {
    if(!pbjs.allBidsAvailable()){
      setTimeout(pbjs.customBidsBackHandler,100);
      return;
    }
    var iframe = document.getElementById('postbid_if');
    var iframeDoc = iframe.contentWindow.document;
    var params = pbjs.getAdserverTargetingForAdUnitCode(doNotChange);
    var price = ADXFloors["5"];
    if (params && params['hb_pb']) // add the KV to ADX ad call
      price = ADXFloors[params['hb_pb']] || ADXFloors["50"]; // use 50 for prices which are higher than 50
    ADXTagHtml = ' google_ad_slot = "' + price + '";' + ADXTagHtml;
    iframe.width = tagWidth;
    iframe.height = tagHeight;
    iframeDoc.write('<scr' + 'ipt>var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent"; var eventer = window[eventMethod]; var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message"; eventer(messageEvent,function(e) {console.log(e.data); if (e.data == "postbid") parent.displayWinnerHB(document);  },false);</scr' + 'ipt><sc' + 'ript type="text/javascript">' + ADXTagHtml + '</scr' + 'ipt>');
    iframeDoc.close();
  }

  var doNotChange = 'doNotChange';

  pbjs.que.push(function() {
    var adUnits = [{
      code: doNotChange,
      sizes: [[tagWidth, tagHeight]],
      bids: bids
    }];

    pbjs.addAdUnits(adUnits);

     // random partner rotation
    pbjs.setBidderSequence('random');

    pbjs.requestBids({
      timeout: bidTimeOut,
      bidsBackHandler: pbjs.customBidsBackHandler
    });
  });

</script>
</head>

<body style="margin:0;padding:0">
<iframe id='postbid_if' FRAMEBORDER="0" SCROLLING="no" MARGINHEIGHT="0" MARGINWIDTH="0" TOPMARGIN="0" LEFTMARGIN="0" ALLOWTRANSPARENCY="true" WIDTH="0" HEIGHT="0"></iframe>
</body>
</html>
